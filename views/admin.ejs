<!DOCTYPE html>
<html>
  <head>
    <title>Admin Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }

      .order-card {
        background: white;
        border: 1px solid #ddd;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }

      .customer-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 15px;
      }

      .order-items table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }

      .order-items th,
      .order-items td {
        padding: 8px;
        border: 1px solid #dee2e6;
        text-align: left;
      }

      .order-items th {
        background-color: #f8f9fa;
      }

      .controls {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border: 1px solid #ffeaa7;
      }

      .control-row {
        display: flex;
        gap: 15px;
        margin: 10px 0;
        align-items: end;
      }

      .control-group {
        display: flex;
        flex-direction: column;
      }

      .control-group label {
        font-size: 12px;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .control-group input {
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        width: 100px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
      }

      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .btn-warning {
        background-color: #ffc107;
        color: #000;
      }
      .btn-danger {
        background-color: #dc3545;
        color: white;
      }

      .btn:hover {
        opacity: 0.9;
      }

      .order-summary {
        background: #e7f3ff;
        padding: 15px;
        border: 1px solid #b3d7ff;
        border-radius: 4px;
        margin: 15px 0;
      }

      .balance-positive {
        color: #28a745;
        font-weight: bold;
      }
      .balance-negative {
        color: #dc3545;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>

    <% if (orders.length === 0) { %>
    <p>No orders found.</p>
    <% } else { %> <% orders.forEach(order => { %>
    <div class="order-card">
      <!-- Order Header -->
      <div class="order-header">
        <h3>Order #<%= order.order_id %></h3>
        <span><%= new Date(order.order_date).toLocaleString() %></span>
      </div>

      <!-- Customer Info -->
      <div class="customer-info">
        <h4>Customer Details</h4>
        <p><strong>Name:</strong> <%= order.name %></p>
        <p><strong>Phone:</strong> <%= order.phone %></p>
        <p><strong>Email:</strong> <%= order.email %></p>
        <p><strong>Address:</strong> <%= order.address %></p>
      </div>

      <!-- Order Items -->
      <div class="order-items">
        <h4>Items Ordered</h4>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th>Quantity</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            <% order.items.forEach(item => { %>
            <tr>
              <td><%= item.color %> <%= item.variant %></td>
              <td><%= item.quantity %></td>
              <td>$<%= item.subtotal.toFixed(2) %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <h4>Order Summary</h4>
        <p>
          <strong>Items Subtotal:</strong> $<%= (order.total_price -
          order.delivery_fee).toFixed(2) %>
        </p>
        <p>
          <strong>Delivery Fee:</strong> $<%= order.delivery_fee.toFixed(2) %>
        </p>
        <p>
          <strong>Total Price:</strong> $<%= order.total_price.toFixed(2) %>
        </p>
        <p><strong>Payments Made:</strong> $<%= order.payments.toFixed(2) %></p>
        <p>
          <strong>Balance Due:</strong>
          <span
            class="<%= order.balance <= 0 ? 'balance-positive' : 'balance-negative' %>"
          >
            $<%= order.balance.toFixed(2) %>
          </span>
        </p>
        <p><strong>Status:</strong> <%= order.status %></p>
      </div>

      <!-- Admin Controls -->
      <div class="controls">
        <h4>Admin Controls</h4>

        <div class="control-row">
          <!-- Record Payment -->
          <form method="POST" action="/admin/pay/<%= order.order_id %>">
            <div class="control-group">
              <label>Record Payment:</label>
              <input
                type="number"
                name="payment"
                step="0.01"
                min="0.01"
                placeholder="Amount"
                required
              />
            </div>
            <button type="submit" class="btn btn-success">
              Record Payment
            </button>
          </form>

          <!-- Adjust Delivery Fee -->
          <form
            method="POST"
            action="/admin/adjust-delivery/<%= order.order_id %>"
          >
            <div class="control-group">
              <label>Delivery Fee:</label>
              <input
                type="number"
                name="delivery_fee"
                step="0.01"
                min="0"
                value="<%= order.delivery_fee.toFixed(2) %>"
                required
              />
            </div>
            <button type="submit" class="btn btn-warning">
              Update Delivery
            </button>
          </form>

          <!-- Apply Discount -->
          <form
            method="POST"
            action="/admin/add-discount/<%= order.order_id %>"
          >
            <div class="control-group">
              <label>Apply Discount:</label>
              <input
                type="number"
                name="discount"
                step="0.01"
                min="0.01"
                placeholder="Amount"
                required
              />
            </div>
            <button type="submit" class="btn btn-danger">Apply Discount</button>
          </form>
        </div>
      </div>
    </div>
    <% }); %> <% } %>
  </body>
</html>
